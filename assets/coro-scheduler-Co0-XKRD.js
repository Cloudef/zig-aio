import{u as n,j as s}from"./index-CmraeOpB.js";const l={title:"CORO API",description:"undefined"};function r(i){const e={a:"a",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",span:"span",...n(),...i.components};return s.jsxs(s.Fragment,{children:[s.jsx(e.header,{children:s.jsxs(e.h1,{id:"coro-api",children:["CORO API",s.jsx(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#coro-api",children:s.jsx(e.div,{"data-autolink-icon":!0})})]})}),`
`,s.jsxs(e.h2,{id:"scheduler",children:["Scheduler",s.jsx(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#scheduler",children:s.jsx(e.div,{"data-autolink-icon":!0})})]}),`
`,s.jsx(e.p,{children:`To do a non-blocking IO while still maintaining the imperative blocking style of coding.
We need a coroutines and a scheduler that schedules the context switches of said coroutines.
In this guide we refer to the coroutines as tasks.`}),`
`,s.jsxs(e.h3,{id:"instanting-a-scheduler",children:["Instanting a Scheduler",s.jsx(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#instanting-a-scheduler",children:s.jsx(e.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(e.p,{children:["Scheduler requires an ",s.jsx(e.code,{children:"allocator"})," and optional ",s.jsx(e.code,{children:"InitOptions"}),`.
The scheduler stores the `,s.jsx(e.code,{children:"allocator"})," and uses it for managed task creation and destruction."]}),`
`,s.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsxs(e.code,{children:[s.jsxs(e.span,{className:"line",children:[s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"var"}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" try"}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" coro"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"Scheduler"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"init"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"gpa"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"allocator"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(), .{});"})]}),`
`,s.jsxs(e.span,{className:"line",children:[s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"defer"}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"deinit"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"();"})]})]})}),`
`,s.jsxs(e.h3,{id:"spawning-tasks",children:["Spawning tasks",s.jsx(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#spawning-tasks",children:s.jsx(e.div,{"data-autolink-icon":!0})})]}),`
`,s.jsxs(e.p,{children:["A new task can be spawned by specifying ",s.jsx(e.code,{children:"entrypoint"}),", which must be a function with either ",s.jsx(e.code,{children:"void"})," or ",s.jsx(e.code,{children:"!void"}),` return type.
If the function is `,s.jsx(e.code,{children:"!void"})," and it returns error, a stacktrace of the error is dumped, similarly to how ",s.jsx(e.code,{children:"std.Thread"}),` api works.
Supply arguments to the `,s.jsx(e.code,{children:"entrypoint"}),` by providing a tuple as the second parameter.
For third parameter, spawn takes a optional `,s.jsx(e.code,{children:"SpawnOptions"}),`, which can be used to specify the stack size of the Task, or
provide a pre-allocated unmanaged task.`]}),`
`,s.jsxs(e.p,{children:["When task is spawned, the ",s.jsx(e.code,{children:"entrypoint"})," is immediately called and the code in the ",s.jsx(e.code,{children:"entrypoint"}),` runs until the task either
yields or performs a IO operation using one of the `,s.jsx(e.code,{children:"coro.io"})," namespace functions."]}),`
`,s.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsx(e.code,{children:s.jsxs(e.span,{className:"line",children:[s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"var"}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" task"}),s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" try"}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"spawn"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"entrypoint"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", .{ "}),s.jsx(e.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"1"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),s.jsx(e.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"args"'}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" }, .{});"})]})})}),`
`,s.jsxs(e.h3,{id:"reaping-tasks",children:["Reaping tasks",s.jsx(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#reaping-tasks",children:s.jsx(e.div,{"data-autolink-icon":!0})})]}),`
`,s.jsx(e.p,{children:"Following removes a task, frees its memory and cancels all potential running IO operations."}),`
`,s.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsx(e.code,{children:s.jsxs(e.span,{className:"line",children:[s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"scheduler"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"reap"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"task"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]})})}),`
`,s.jsx(e.p,{children:"Alternatively reap all the tasks using the following."}),`
`,s.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsx(e.code,{children:s.jsxs(e.span,{className:"line",children:[s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"scheduler"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"reapAll"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"();"})]})})}),`
`,s.jsxs(e.p,{children:["Call to ",s.jsx(e.code,{children:"deinit"})," also reaps all tasks."]}),`
`,s.jsxs(e.h3,{id:"running",children:["Running",s.jsx(e.a,{"aria-hidden":"true",tabIndex:"-1",href:"#running",children:s.jsx(e.div,{"data-autolink-icon":!0})})]}),`
`,s.jsx(e.p,{children:`The scheduler can process tasks and io one step a time with the tick method.
By running tick the scheduler will reap tasks that returned (dead tasks) and context switch back to the
tasks in case they completed their IO operations.`}),`
`,s.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsxs(e.code,{children:[s.jsx(e.span,{className:"line",children:s.jsx(e.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// if there are pending io operations, blocks until at least one completes"})}),`
`,s.jsxs(e.span,{className:"line",children:[s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"try"}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"tick"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(."}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"blocking"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]}),`
`,s.jsx(e.span,{className:"line",children:s.jsx(e.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// returns immediately regardless of the current io state"})}),`
`,s.jsxs(e.span,{className:"line",children:[s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"try"}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"tick"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(."}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"nonblocking"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]})]})}),`
`,s.jsx(e.p,{children:"To run the scheduler until all tasks have returned aka died, then use the following."}),`
`,s.jsx(e.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:s.jsx(e.code,{children:s.jsxs(e.span,{className:"line",children:[s.jsx(e.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"try"}),s.jsx(e.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),s.jsx(e.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"run"}),s.jsx(e.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"();"})]})})})]})}function d(i={}){const{wrapper:e}={...n(),...i.components};return e?s.jsx(e,{...i,children:s.jsx(r,{...i})}):r(i)}export{d as default,l as frontmatter};
