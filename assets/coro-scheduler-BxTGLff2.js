import{u as n,j as e}from"./index-Dlhl0a3b.js";const l={title:"CORO API",description:"undefined"};function r(i){const s={a:"a",code:"code",div:"div",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",span:"span",...n(),...i.components};return e.jsxs(e.Fragment,{children:[e.jsx(s.header,{children:e.jsxs(s.h1,{id:"coro-api",children:["CORO API",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#coro-api",children:e.jsx(s.div,{"data-autolink-icon":!0})})]})}),`
`,e.jsxs(s.h2,{id:"scheduler",children:["Scheduler",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#scheduler",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsx(s.p,{children:`To do a non-blocking IO while still maintaining the imperative blocking style of coding.
We need a coroutines and a scheduler that schedules the context switches of said coroutines.
In this guide we refer to the coroutines as tasks.`}),`
`,e.jsxs(s.h3,{id:"initializing-scheduler-instance",children:["Initializing Scheduler instance",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#initializing-scheduler-instance",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:["Scheduler requires an ",e.jsx(s.code,{children:"allocator"})," and optional ",e.jsx(s.code,{children:"InitOptions"}),`.
The scheduler stores the `,e.jsx(s.code,{children:"allocator"})," and uses it for managed task creation and destruction."]}),`
`,e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsxs(s.code,{children:[e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"var"}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" try"}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" coro"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"Scheduler"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"init"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"gpa"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"allocator"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(), .{});"})]}),`
`,e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"defer"}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"deinit"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"();"})]})]})}),`
`,e.jsxs(s.h3,{id:"spawning-tasks",children:["Spawning tasks",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#spawning-tasks",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsxs(s.p,{children:["A new task can be spawned by specifying ",e.jsx(s.code,{children:"entrypoint"}),", which must be a function with either ",e.jsx(s.code,{children:"void"})," or ",e.jsx(s.code,{children:"!void"}),` return type.
If it's `,e.jsx(s.code,{children:"!void"})," and returns a error then a stacktrace of the error is dumped, similarly to how std's ",e.jsx(s.code,{children:"std.Thread"}),` works.
Supply arguments to the `,e.jsx(s.code,{children:"entrypoint"}),` by providing a tuple as the second parameter.
The third parameter takes a optional `,e.jsx(s.code,{children:"SpawnOptions"}),`, which can be used to specify the stack size of the Task, or
provide a pre-allocated unmanaged stack.`]}),`
`,e.jsxs(s.p,{children:["When task is spawned, the ",e.jsx(s.code,{children:"entrypoint"})," is immediately called and the code in the ",e.jsx(s.code,{children:"entrypoint"}),` runs until the task either
yields or performs a IO operation using one of the `,e.jsx(s.code,{children:"coro.io"})," namespace functions."]}),`
`,e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"var"}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" task"}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" ="}),e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:" try"}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"spawn"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"entrypoint"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", .{ "}),e.jsx(s.span,{style:{color:"#005CC5","--shiki-dark":"#6CB6FF"},children:"1"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:", "}),e.jsx(s.span,{style:{color:"#032F62","--shiki-dark":"#96D0FF"},children:'"args"'}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:" }, .{});"})]})})}),`
`,e.jsxs(s.h3,{id:"reaping-tasks",children:["Reaping tasks",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#reaping-tasks",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsx(s.p,{children:`Following removes a task, freeing its memory and canceling all running IO operations for that task.
The reap may be delayed in case the task is currently doing IO, the IO operations will be actively canceled.`}),`
`,e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"scheduler"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"reap"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"("}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"task"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]})})}),`
`,e.jsx(s.p,{children:`Alternatively reap all the tasks using the following.
The reap may be delayed in case the tasks are currently doing IO, the IO operations will be actively canceled.`}),`
`,e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"scheduler"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"reapAll"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"();"})]})})}),`
`,e.jsxs(s.p,{children:["Call to ",e.jsx(s.code,{children:"deinit"})," also reaps all tasks."]}),`
`,e.jsxs(s.h3,{id:"running",children:["Running",e.jsx(s.a,{"aria-hidden":"true",tabIndex:"-1",href:"#running",children:e.jsx(s.div,{"data-autolink-icon":!0})})]}),`
`,e.jsx(s.p,{children:`The scheduler can process tasks and io one step a time with the tick method.
By running tick the scheduler will reap tasks that returned (dead tasks) and context switch back to the
tasks in case they completed their IO operations.`}),`
`,e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsxs(s.code,{children:[e.jsx(s.span,{className:"line",children:e.jsx(s.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// if there are pending io operations, blocks until at least one completes"})}),`
`,e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"try"}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"tick"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(."}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"blocking"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]}),`
`,e.jsx(s.span,{className:"line",children:e.jsx(s.span,{style:{color:"#6A737D","--shiki-dark":"#768390"},children:"// returns immediately regardless of the current io state"})}),`
`,e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"try"}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"tick"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"(."}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:"nonblocking"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:");"})]})]})}),`
`,e.jsx(s.p,{children:"To run the scheduler until all tasks have returned aka died, then use the following."}),`
`,e.jsx(s.pre,{className:"shiki shiki-themes github-light github-dark-dimmed",style:{backgroundColor:"#fff","--shiki-dark-bg":"#22272e",color:"#24292e","--shiki-dark":"#adbac7"},tabIndex:"0",children:e.jsx(s.code,{children:e.jsxs(s.span,{className:"line",children:[e.jsx(s.span,{style:{color:"#D73A49","--shiki-dark":"#F47067"},children:"try"}),e.jsx(s.span,{style:{color:"#E36209","--shiki-dark":"#F69D50"},children:" scheduler"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"."}),e.jsx(s.span,{style:{color:"#6F42C1","--shiki-dark":"#DCBDFB"},children:"run"}),e.jsx(s.span,{style:{color:"#24292E","--shiki-dark":"#ADBAC7"},children:"();"})]})})})]})}function d(i={}){const{wrapper:s}={...n(),...i.components};return s?e.jsx(s,{...i,children:e.jsx(r,{...i})}):r(i)}export{d as default,l as frontmatter};
